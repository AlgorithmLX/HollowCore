#version 120

uniform int t;
uniform int windowX;
uniform int windowY;

float P(id, a, b, c, d, e, f, g, h) {
    if (id == int(pos.y)) {
        int pa = a+2*(b+2*(c+2*(d+2*(e+2*(f+2*(g+2*(h)))))));
        return floor(mod(float(pa) / pow(2., float(pos.x)-1.), 2.));
    }
    return 0;
}

float gray(vec3 _i) {
    return _i.x*0.299+_i.y*0.587+_i.z*0.114;
}

void main() {
    vec2 uv = vec2(floor(texcoord.x/8./zoom)*8.*zoom, floor(texcoord.y/12./zoom)*12.*zoom)/vec2(windowX, windowY);
    ivec2 pos = ivec2(mod(texcoord.x/zoom, 8.), mod(texcoord.y/zoom, 12.));
    vec4 tex = texture2D(bgl_RenderedTexture, uv);
    float cha = 0.;

    float g = gray(tex.xyz);
    if (g < .125)
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(9, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(8, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(7, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(6, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(5, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(4, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(3, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(2, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(1, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .25)// .
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(9, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(8, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(7, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(6, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(5, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(4, 0, 0, 0, 1, 1, 0, 0, 0);
        cha = P(3, 0, 0, 0, 1, 1, 0, 0, 0);
        cha = P(2, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(1, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .375)// ,
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(9, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(8, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(7, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(6, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(5, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(4, 0, 0, 0, 1, 1, 0, 0, 0);
        cha = P(3, 0, 0, 0, 1, 1, 0, 0, 0);
        cha = P(2, 0, 0, 0, 0, 1, 0, 0, 0);
        cha = P(1, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .5)// -
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(9, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(8, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(7, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(6, 1, 1, 1, 1, 1, 1, 1, 0);
        cha = P(5, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(4, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(3, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(2, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(1, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .625)// +
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(9, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(8, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(7, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(6, 1, 1, 1, 1, 1, 1, 1, 0);
        cha = P(5, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(4, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(3, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(2, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(1, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .75)// *
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(9, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(8, 0, 1, 0, 1, 0, 1, 0, 0);
        cha = P(7, 0, 0, 1, 1, 1, 0, 0, 0);
        cha = P(6, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(5, 0, 0, 1, 1, 1, 0, 0, 0);
        cha = P(4, 0, 1, 0, 1, 0, 1, 0, 0);
        cha = P(3, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(2, 0, 0, 0, 1, 0, 0, 0, 0);
        cha = P(1, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else if (g < .875)// #
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 1, 0, 0, 1, 0, 0);
        cha = P(9, 0, 0, 1, 0, 0, 1, 0, 0);
        cha = P(8, 1, 1, 1, 1, 1, 1, 1, 0);
        cha = P(7, 0, 0, 1, 0, 0, 1, 0, 0);
        cha = P(6, 0, 0, 1, 0, 0, 1, 0, 0);
        cha = P(5, 0, 1, 0, 0, 1, 0, 0, 0);
        cha = P(4, 0, 1, 0, 0, 1, 0, 0, 0);
        cha = P(3, 1, 1, 1, 1, 1, 1, 1, 0);
        cha = P(2, 0, 1, 0, 0, 1, 0, 0, 0);
        cha = P(1, 0, 1, 0, 0, 1, 0, 0, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }
    else // @
    {
        cha = P(11, 0, 0, 0, 0, 0, 0, 0, 0);
        cha = P(10, 0, 0, 1, 1, 1, 1, 0, 0);
        cha = P(9, 0, 1, 0, 0, 0, 0, 1, 0);
        cha = P(8, 1, 0, 0, 0, 1, 1, 1, 0);
        cha = P(7, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(6, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(5, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(4, 1, 0, 0, 1, 0, 0, 1, 0);
        cha = P(3, 1, 0, 0, 1, 1, 1, 1, 0);
        cha = P(2, 0, 1, 0, 0, 0, 0, 0, 0);
        cha = P(1, 0, 0, 1, 1, 1, 1, 1, 0);
        cha = P(0, 0, 0, 0, 0, 0, 0, 0, 0);
    }

    vec3 col = tex.xyz/max(tex.x, max(tex.y, tex.z));
    gl_FragColor = vec4(cha*col, 1.);
}
